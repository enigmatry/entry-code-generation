@using Enigmatry.CodeGeneration
@using Enigmatry.CodeGeneration.Angular
@using Enigmatry.CodeGeneration.Configuration.List.Model
@using Enigmatry.CodeGeneration.Templates.HtmlHelperExtensions.Angular
@using Enigmatry.CodeGeneration.Templates.HtmlHelperExtensions.TypeScript
@model Enigmatry.CodeGeneration.Configuration.List.ListComponentModel;
@inject CodeGeneratorOptions _options;
import { ChangeDetectionStrategy, Component, EventEmitter, Input, OnInit, Output, TemplateRef, ViewChild } from '@@angular/core';
import { CellTemplate, ColumnDef, ContextMenuItem } from 'src/@@enigmatry/enigmatry-grid';
import { PagedData, PageEvent, SortEvent } from 'src/@@enigmatry/pagination';

import { @(Model.ComponentInfo.ModelType) } from '@_options.ApiClientTsImportPath';

@@Component({
  selector: '@Model.AngularComponentSelector(_options.ComponentPrefix)',
  templateUrl: './@(Model.AngularComponentFileName()).html',
  styleUrls: ['./@(Model.AngularComponentFileName()).scss'],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class @Model.AngularComponentName() implements OnInit {

  @@Input() data: PagedData@(Html.Raw($"<{Model.ComponentInfo.ModelType}>")) | null;
  @@Input() loading: boolean;

  @@Input() showPaginator = @Model.Pagination.ShowPaginator.ToString().ToLower();
  @@Input() showFirstLastButtons = @Model.Pagination.ShowFirstLastPageButtons.ToString().ToLower();
  @@Input() pageSizeOptions = @Html.JsArray(Model.Pagination.PageSizeOptions);
  @@Input() hidePageSize = !@Model.Pagination.ShowPageSize.ToString().ToLower();

  @@Input() rowSelectable = @Model.Row.IsSelectable.ToString().ToLower();
  @@Input() multiSelectable = @((Model.Row.Selection == RowSelectionType.Multiple).ToString().ToLower());

  @@Input() headerTemplate: TemplateRef@(Html.Raw("<any>")) | CellTemplate;
  @@Input() cellTemplate: TemplateRef@(Html.Raw("<any>")) | CellTemplate;

  @@Input() showContextMenu = @Model.Row.ShowContextMenu.ToString().ToLower();
  @@Input() contextMenuItems: ContextMenuItem[] = [];

  @@Input() columns: ColumnDef[] = [];

  @@Output() pageChange = new EventEmitter@(Html.Raw("<PageEvent>"))();
  @@Output() sortChange = new EventEmitter@(Html.Raw("<SortEvent>"))();
  @@Output() selectionChange = new EventEmitter@(Html.Raw($"<{Model.ComponentInfo.ModelType}[]>"))();
  @@Output() contextMenuItemSelected = new EventEmitter<@(Html.Raw($"{{ itemId: string; rowData: {Model.ComponentInfo.ModelType} }}"))>();

  @Html.AllCustomCellTemplateViewChildRefs(Model.Columns)

  constructor() {
    this.columns = @Html.CreateColumnDefs(Model.Columns);
    this.contextMenuItems = @Html.CreateContextMenuItems(Model.Row.ContextMenuItems);
  }

  ngOnInit(): void {
  }
}
