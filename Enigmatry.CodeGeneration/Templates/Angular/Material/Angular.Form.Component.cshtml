@using Enigmatry.CodeGeneration
@using Enigmatry.CodeGeneration.Angular
@model Enigmatry.CodeGeneration.Configuration.Form.FormComponentModel;
@inject CodeGeneratorOptions _options;
import { Component, EventEmitter, Input, OnInit, Output } from '@@angular/core';
import { FormGroup } from '@@angular/forms';
import { FormlyFieldConfig } from '@@ngx-formly/core';
import { I@(Model.ComponentInfo.ModelType) } from '@_options.ApiClientTsImportPath';

@@Component({
  selector: '@Model.AngularComponentSelector(_options.ComponentPrefix)',
  templateUrl: './@(Model.AngularComponentFileName()).html',
  styleUrls: ['./@(Model.AngularComponentFileName()).scss']
})
export class @Model.AngularComponentName() implements OnInit {

  @@Input() model: I@(Model.ComponentInfo.ModelType) = {};

  @@Output() save = new EventEmitter@(Html.Raw($"<I{Model.ComponentInfo.ModelType}>"))();
  @@Output() cancel = new EventEmitter@(Html.Raw("<void>"))();

  form = new FormGroup({});
  fields: FormlyFieldConfig[] = [];

  constructor() {
    this.fields = [@foreach (var control in Model.VisibleFormControls)
   {
     @:{
        @:key: '@control.PropertyName',
        @:type: '@control.GetFormlyFieldType()',
        @:templateOptions: {
          @:label: '@control.Label',
          @:placeholder: '@control.Placeholder',
          @:readonly: @control.IsReadonly.ToString().ToLower(),
          @:hidden: !@control.IsVisible.ToString().ToLower()
        @:}
      @:},
   }];
 }

  ngOnInit(): void {
  }

  onSubmit() {
    if (this.form.valid) {
      this.save.emit(this.model);
    }
  }
}
